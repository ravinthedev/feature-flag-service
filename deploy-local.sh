#!/bin/bash

set -e

echo "ğŸš€ Setting up Feature Flag Service..."
echo ""

echo "ğŸ“„ Copying environment files..."
cp environments/local/backend.env backend/.env
cp environments/local/frontend.env frontend/.env.local

echo "ğŸ³ Starting Docker services..."
cd environments/local
docker compose --env-file docker.env up -d

echo "â³ Waiting for services to be ready..."
sleep 10

echo "ğŸ”§ Running backend setup..."
docker exec feature-flag-backend php artisan key:generate
docker exec feature-flag-backend php artisan migrate --force
docker exec feature-flag-backend php artisan db:seed --force
docker exec feature-flag-backend php artisan storage:link

echo ""
echo "âœ… Setup complete!"
echo ""
echo "Access the application:"
echo "  Frontend: http://localhost:3000"
echo "  Backend:  http://localhost:8000/api"
echo ""
echo "Login credentials:"
echo "  Admin: admin@example.com / password"
echo "  User:  user@example.com / password"
echo ""
echo "To stop: cd environments/local && docker compose down"
